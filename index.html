<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MARSI-R Digital Inventory - Accessible Version</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        /* High contrast and accessibility focused design */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #1e3a8a;
            --secondary-color: #3b82f6;
            --accent-color: #059669;
            --warning-color: #d97706;
            --error-color: #dc2626;
            --text-color: #1f2937;
            --background-color: #ffffff;
            --light-background: #f9fafb;
            --border-color: #d1d5db;
            --focus-color: #2563eb;
            --focus-background: #dbeafe;
        }

        /* High contrast mode support */
        @media (prefers-contrast: high) {
            :root {
                --primary-color: #000000;
                --secondary-color: #000000;
                --accent-color: #000000;
                --text-color: #000000;
                --background-color: #ffffff;
                --border-color: #000000;
            }
        }

        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        body {
            font-family: 'Arial', 'Helvetica', sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--light-background);
            font-size: 16px;
            min-height: 100vh;
            padding: 20px;
        }

        /* Skip link for keyboard navigation */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 6px;
            background: var(--primary-color);
            color: white;
            padding: 8px;
            text-decoration: none;
            border-radius: 4px;
            z-index: 1000;
        }

        .skip-link:focus {
            top: 6px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: var(--background-color);
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            border: 2px solid var(--border-color);
        }

        .header {
            background: var(--primary-color);
            color: white;
            padding: 40px 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.25rem;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .header p {
            font-size: 1.125rem;
            opacity: 0.95;
            margin-bottom: 5px;
        }

        .authors {
            font-size: 1rem;
            font-style: italic;
        }

        .copyright {
            font-size: 0.9rem;
        }

        .header .adaptation {
            font-size: 0.7rem !important;
            opacity: 0.7 !important;
            margin-top: 10px;
            line-height: 1.4;
        }

        .content {
            padding: 40px 30px;
        }

        .section {
            margin-bottom: 40px;
            padding: 30px;
            background: var(--light-background);
            border-radius: 8px;
            border: 2px solid var(--border-color);
        }

        .section h2 {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 1.5rem;
            font-weight: 600;
        }

        /* Focus management */
        *:focus {
            outline: 3px solid var(--focus-color);
            outline-offset: 2px;
            background-color: var(--focus-background);
        }

        /* Remove focus outline for mouse users */
        .mouse-user *:focus {
            outline: none;
            background-color: transparent;
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-row {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .form-col {
            flex: 1;
            min-width: 200px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--primary-color);
            font-size: 1rem;
        }

        /* Required field indicator */
        .required::after {
            content: " *";
            color: var(--error-color);
            font-weight: bold;
        }

        input[type="text"], 
        input[type="number"], 
        select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            font-size: 16px;
            font-family: inherit;
            background-color: var(--background-color);
            color: var(--text-color);
        }

        input[type="text"]:focus, 
        input[type="number"]:focus, 
        select:focus {
            border-color: var(--focus-color);
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.2);
        }

        /* Radio button styling for better accessibility */
        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 8px;
        }

        .radio-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 8px;
            border-radius: 6px;
            border: 2px solid transparent;
        }

        .radio-item:hover {
            background-color: var(--light-background);
            border-color: var(--border-color);
        }

        .radio-item input[type="radio"] {
            width: 20px;
            height: 20px;
            margin: 0;
            flex-shrink: 0;
            accent-color: var(--primary-color);
        }

        .radio-item label {
            margin: 0;
            cursor: pointer;
            font-weight: 400;
            color: var(--text-color);
        }

        .instructions {
            background: #eff6ff;
            border: 2px solid var(--secondary-color);
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 30px;
        }

        .instructions h3 {
            color: var(--primary-color);
            margin-bottom: 16px;
            font-size: 1.25rem;
        }

        .instructions ol {
            padding-left: 24px;
            margin: 16px 0;
        }

        .instructions li {
            margin-bottom: 8px;
        }

        .scale-info {
            background: #fefce8;
            border: 2px solid var(--warning-color);
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 30px;
        }

        .scale-info h4 {
            color: var(--warning-color);
            margin-bottom: 12px;
            font-size: 1.125rem;
        }

        .scale-info ol {
            padding-left: 24px;
        }

        .scale-info li {
            margin-bottom: 8px;
            color: var(--text-color);
        }

        /* Strategy items with better accessibility */
        .strategy-item {
            margin-bottom: 24px;
            padding: 20px;
            background: var(--background-color);
            border-radius: 8px;
            border: 2px solid var(--border-color);
        }

        .strategy-item:focus-within {
            border-color: var(--focus-color);
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.2);
        }

        .strategy-header {
            display: flex;
            align-items: flex-start;
            margin-bottom: 16px;
            gap: 16px;
        }

        .strategy-number {
            background: var(--primary-color);
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 16px;
            flex-shrink: 0;
        }

        .strategy-text {
            font-size: 1rem;
            color: var(--text-color);
            font-weight: 500;
            line-height: 1.5;
        }

        /* Accessible rating system */
        .rating-fieldset {
            border: none;
            padding: 0;
            margin: 0;
        }

        .rating-legend {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 12px;
            font-size: 1rem;
        }

        .rating-options {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }

        .rating-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .rating-input {
            width: 20px;
            height: 20px;
            accent-color: var(--primary-color);
        }

        .rating-label {
            font-size: 0.875rem;
            text-align: center;
            color: var(--text-color);
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            border: 1px solid transparent;
        }

        .rating-input:checked + .rating-label {
            background-color: var(--primary-color);
            color: white;
            font-weight: 600;
        }

        .rating-input:focus + .rating-label {
            border-color: var(--focus-color);
        }

        /* Progress indicator */
        .progress-section {
            margin-bottom: 30px;
            padding: 20px;
            background: var(--light-background);
            border-radius: 8px;
            border: 2px solid var(--border-color);
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background-color: #e5e7eb;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--accent-color);
            transition: width 0.3s ease;
            border-radius: 10px;
        }

        .progress-text {
            text-align: center;
            font-weight: 600;
            color: var(--primary-color);
        }

        /* Results section */
        .results-section {
            background: #f0fdf4;
            border: 2px solid var(--accent-color);
            border-radius: 8px;
            padding: 30px;
            margin-top: 30px;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 24px;
        }

        .result-card {
            background: var(--background-color);
            padding: 24px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid var(--border-color);
        }

        .result-card h4 {
            color: var(--primary-color);
            margin-bottom: 12px;
            font-size: 1.125rem;
        }

        .result-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--accent-color);
            margin-bottom: 8px;
        }

        .result-level {
            font-size: 0.875rem;
            color: var(--text-color);
            font-weight: 500;
        }

        .export-section {
            display: flex;
            gap: 16px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .export-btn {
            background: var(--primary-color);
            color: white;
            border: 2px solid var(--primary-color);
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            font-family: inherit;
        }

        .export-btn:hover {
            background: var(--secondary-color);
            border-color: var(--secondary-color);
        }

        .export-btn:focus {
            outline: 3px solid var(--focus-color);
            outline-offset: 2px;
        }

        .interpretation {
            background: var(--background-color);
            border-radius: 8px;
            padding: 24px;
            margin-top: 24px;
            border: 2px solid var(--border-color);
        }

        .interpretation h4 {
            color: var(--primary-color);
            margin-bottom: 12px;
            font-size: 1.125rem;
        }

        .interpretation ul {
            padding-left: 24px;
        }

        .interpretation li {
            margin-bottom: 8px;
        }

        /* Error and validation styles */
        .error {
            color: var(--error-color);
            font-size: 0.875rem;
            margin-top: 4px;
        }

        .error-border {
            border-color: var(--error-color) !important;
        }

        /* Screen reader only content */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 8px;
            }
            
            .content {
                padding: 20px 16px;
            }
            
            .header {
                padding: 30px 20px;
            }
            
            .header h1 {
                font-size: 1.875rem;
            }
            
            .form-row {
                flex-direction: column;
                gap: 16px;
            }
            
            .rating-options {
                justify-content: center;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }

            .export-section {
                flex-direction: column;
                align-items: center;
            }

            .export-btn {
                width: 100%;
                max-width: 300px;
            }
        }

        /* Print styles */
        @media print {
            .export-section {
                display: none;
            }
            
            body {
                background: white;
                color: black;
            }
            
            .container {
                box-shadow: none;
                border: 1px solid black;
            }
        }
    </style>
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <div class="container">
        <header class="header" role="banner">
            <h1>MARSI-R Digital Inventory</h1>
            <p>Metacognitive Awareness of Reading Strategies Inventory - Revised</p>
            <p class="authors">By Kouider Mokhtari, Dimiter M. Dimitrov, and Carla A. Reichard</p>
            <p class="copyright">Â© 2018</p>
            <p class="adaptation">Adapted for digital use in 2025, with permission from the authors, by Katie W. Biehl, West Shore Community College Instructional Design Team</p>
        </header>

        <main id="main-content" class="content" role="main">
            <!-- Progress Section -->
            <section class="progress-section" aria-labelledby="progress-heading">
                <h2 id="progress-heading" class="sr-only">Completion Progress</h2>
                <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" aria-labelledby="progress-text">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
                <div class="progress-text" id="progress-text">0% Complete (0 of 15 strategies rated)</div>
            </section>

            <!-- General Information Section -->
            <section class="section" aria-labelledby="info-heading">
                <h2 id="info-heading">General Information</h2>
                
                <div class="form-row">
                    <div class="form-col">
                        <label for="name" class="required">Name:</label>
                        <input type="text" id="name" name="name" required aria-describedby="name-help">
                        <div id="name-help" class="sr-only">Enter your full name</div>
                    </div>
                    <div class="form-col">
                        <label for="age" class="required">Age:</label>
                        <input type="number" id="age" name="age" min="5" max="100" required aria-describedby="age-help">
                        <div id="age-help" class="sr-only">Enter your age in years</div>
                    </div>
                    <div class="form-col">
                        <label for="grade" class="required">Grade:</label>
                        <input type="text" id="grade" name="grade" required aria-describedby="grade-help">
                        <div id="grade-help" class="sr-only">Enter your current grade or education level</div>
                    </div>
                </div>

                <fieldset class="form-group">
                    <legend class="required">Gender:</legend>
                    <div class="radio-group" role="radiogroup" aria-labelledby="gender-legend">
                        <div class="radio-item">
                            <input type="radio" id="male" name="gender" value="male" required>
                            <label for="male">Male</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" id="female" name="gender" value="female" required>
                            <label for="female">Female</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" id="other-gender" name="gender" value="other" required>
                            <label for="other-gender">Other</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" id="prefer-not-gender" name="gender" value="prefer-not" required>
                            <label for="prefer-not-gender">Prefer not to answer</label>
                        </div>
                    </div>
                </fieldset>

                <fieldset class="form-group">
                    <legend class="required">Ethnicity:</legend>
                    <div class="radio-group" role="radiogroup" aria-labelledby="ethnicity-legend">
                        <div class="radio-item">
                            <input type="radio" id="african" name="ethnicity" value="african" required>
                            <label for="african">African American/Black</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" id="caucasian" name="ethnicity" value="caucasian" required>
                            <label for="caucasian">Caucasian/White</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" id="indian" name="ethnicity" value="indian" required>
                            <label for="indian">American Indian</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" id="asian" name="ethnicity" value="asian" required>
                            <label for="asian">Asian American</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" id="hispanic" name="ethnicity" value="hispanic" required>
                            <label for="hispanic">Hispanic/Latino</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" id="other-ethnicity" name="ethnicity" value="other" required>
                            <label for="other-ethnicity">Other</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" id="prefer-not-ethnicity" name="ethnicity" value="prefer-not" required>
                            <label for="prefer-not-ethnicity">Prefer not to answer</label>
                        </div>
                    </div>
                </fieldset>

                <fieldset class="form-group">
                    <legend class="required">I consider myself:</legend>
                    <div class="radio-group" role="radiogroup" aria-labelledby="reading-level-legend">
                        <div class="radio-item">
                            <input type="radio" id="excellent" name="reading_level" value="excellent" required>
                            <label for="excellent">An excellent reader</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" id="good" name="reading_level" value="good" required>
                            <label for="good">A good reader</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" id="average" name="reading_level" value="average" required>
                            <label for="average">An average reader</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" id="poor" name="reading_level" value="poor" required>
                            <label for="poor">A poor reader</label>
                        </div>
                    </div>
                </fieldset>
            </section>

            <!-- Instructions Section -->
            <section class="instructions" aria-labelledby="instructions-heading">
                <h3 id="instructions-heading">Instructions for Completing the Inventory</h3>
                <p>The statements listed below describe 15 strategies or actions readers use when reading academic or school-related materials such as book chapters, journal articles, stories, etc.</p>
                
                <ol>
                    <li><strong>Step 1:</strong> Read each statement to determine whether you are aware of and/or use these strategies when you read.</li>
                    <li><strong>Step 2:</strong> Use the rating scale below to show your strategy awareness and/or use.</li>
                    <li><strong>Step 3:</strong> Select the appropriate number (1, 2, 3, 4, or 5) for each strategy statement.</li>
                </ol>
                
                <p><em>There are no right or wrong answers. It takes about 7-10 minutes to complete. All fields marked with an asterisk (*) are required.</em></p>
            </section>

            <!-- Scale Information -->
            <section class="scale-info" aria-labelledby="scale-heading">
                <h4 id="scale-heading">Strategy Scale:</h4>
                <ol>
                    <li><strong>1:</strong> I have never heard of this strategy before.</li>
                    <li><strong>2:</strong> I have heard of this strategy, but I don't know what it means.</li>
                    <li><strong>3:</strong> I have heard of this strategy, and I think I know what it means.</li>
                    <li><strong>4:</strong> I know this strategy, and I can explain how and when to use it.</li>
                    <li><strong>5:</strong> I know this strategy quite well, and I often use it when I read.</li>
                </ol>
            </section>

            <!-- Strategies Section -->
            <section class="section" aria-labelledby="strategies-heading">
                <h2 id="strategies-heading">Reading Strategies (1-15)</h2>
                <div id="strategies-container" role="group" aria-labelledby="strategies-heading">
                    <!-- Strategies will be dynamically generated here -->
                </div>
            </section>

            <!-- Results Section -->
            <section class="results-section" id="results-section" style="display: none;" aria-labelledby="results-heading">
                <h2 id="results-heading">Your Results</h2>
                <div class="results-grid">
                    <div class="result-card" role="region" aria-labelledby="grs-heading">
                        <h4 id="grs-heading">Global Reading Strategies</h4>
                        <div class="result-value" id="grs-score" aria-live="polite">0.0</div>
                        <div class="result-level" id="grs-level" aria-live="polite">Not calculated</div>
                    </div>
                    <div class="result-card" role="region" aria-labelledby="pss-heading">
                        <h4 id="pss-heading">Problem-Solving Strategies</h4>
                        <div class="result-value" id="pss-score" aria-live="polite">0.0</div>
                        <div class="result-level" id="pss-level" aria-live="polite">Not calculated</div>
                    </div>
                    <div class="result-card" role="region" aria-labelledby="srs-heading">
                        <h4 id="srs-heading">Support Reading Strategies</h4>
                        <div class="result-value" id="srs-score" aria-live="polite">0.0</div>
                        <div class="result-level" id="srs-level" aria-live="polite">Not calculated</div>
                    </div>
                    <div class="result-card" role="region" aria-labelledby="total-heading">
                        <h4 id="total-heading">Total Reading Strategies</h4>
                        <div class="result-value" id="total-score" aria-live="polite">0.0</div>
                        <div class="result-level" id="total-level" aria-live="polite">Not calculated</div>
                    </div>
                </div>

                <div class="interpretation" role="region" aria-labelledby="interpretation-heading">
                    <h4 id="interpretation-heading">Scoring and Interpretation</h4>
                    
                    <div class="scoring-table" style="margin-bottom: 20px;">
                        <h5 style="color: var(--primary-color); margin-bottom: 10px;">Strategy Categories:</h5>
                        <table style="width: 100%; border-collapse: collapse; margin-bottom: 15px;">
                            <thead>
                                <tr style="background-color: var(--light-background);">
                                    <th style="border: 2px solid var(--border-color); padding: 8px; text-align: left;">Category</th>
                                    <th style="border: 2px solid var(--border-color); padding: 8px; text-align: left;">Items</th>
                                    <th style="border: 2px solid var(--border-color); padding: 8px; text-align: left;">Your Score</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="border: 2px solid var(--border-color); padding: 8px; font-weight: 600;">Global Reading Strategies</td>
                                    <td style="border: 2px solid var(--border-color); padding: 8px;">1, 3, 5, 12, 13</td>
                                    <td style="border: 2px solid var(--border-color); padding: 8px;" id="grs-table-score">Not calculated</td>
                                </tr>
                                <tr>
                                    <td style="border: 2px solid var(--border-color); padding: 8px; font-weight: 600;">Problem-Solving Strategies</td>
                                    <td style="border: 2px solid var(--border-color); padding: 8px;">7, 9, 11, 14, 15</td>
                                    <td style="border: 2px solid var(--border-color); padding: 8px;" id="pss-table-score">Not calculated</td>
                                </tr>
                                <tr>
                                    <td style="border: 2px solid var(--border-color); padding: 8px; font-weight: 600;">Support Reading Strategies</td>
                                    <td style="border: 2px solid var(--border-color); padding: 8px;">2, 4, 6, 8, 10</td>
                                    <td style="border: 2px solid var(--border-color); padding: 8px;" id="srs-table-score">Not calculated</td>
                                </tr>
                                <tr style="background-color: var(--light-background); font-weight: bold;">
                                    <td style="border: 2px solid var(--border-color); padding: 8px;">Total Reading Strategies</td>
                                    <td style="border: 2px solid var(--border-color); padding: 8px;">All 15 items</td>
                                    <td style="border: 2px solid var(--border-color); padding: 8px;" id="total-table-score">Not calculated</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <h5 style="color: var(--primary-color); margin-bottom: 10px;">Interpretation Guide:</h5>
                    <ul style="margin-bottom: 20px;">
                        <li><strong>High level of awareness:</strong> 3.5 or higher</li>
                        <li><strong>Medium level of awareness:</strong> 2.5-3.4</li>
                        <li><strong>Low level of awareness:</strong> 2.4 or lower</li>
                    </ul>

                    <div class="category-explanations">
                        <h5 style="color: var(--primary-color); margin-bottom: 15px;">Strategy Category Explanations:</h5>
                        
                        <div style="margin-bottom: 15px;">
                            <h6 style="font-weight: 600; color: var(--secondary-color); margin-bottom: 5px;">Global Reading Strategies (Items 1, 3, 5, 12, 13)</h6>
                            <p style="margin-bottom: 10px; line-height: 1.5;">These strategies involve setting reading goals, making predictions about text content, and using text structure to aid comprehension. They are intentional, carefully planned techniques that readers use to monitor or manage their reading. Examples include having a purpose in mind when reading, previewing text, and critically analyzing information.</p>
                        </div>

                        <div style="margin-bottom: 15px;">
                            <h6 style="font-weight: 600; color: var(--secondary-color); margin-bottom: 5px;">Problem-Solving Strategies (Items 7, 9, 11, 14, 15)</h6>
                            <p style="margin-bottom: 10px; line-height: 1.5;">These are actions and procedures that readers use when they encounter difficulties while reading or when text becomes difficult to understand. They involve adjusting reading behaviors when comprehension problems arise. Examples include re-reading, adjusting reading pace, and using context clues to understand unknown words.</p>
                        </div>

                        <div style="margin-bottom: 15px;">
                            <h6 style="font-weight: 600; color: var(--secondary-color); margin-bottom: 5px;">Support Reading Strategies (Items 2, 4, 6, 8, 10)</h6>
                            <p style="margin-bottom: 10px; line-height: 1.5;">These are basic support mechanisms intended to help readers understand text more effectively. They include practical techniques and external resources that aid comprehension. Examples include taking notes, using reference materials, discussing content with others, and highlighting important information.</p>
                        </div>
                    </div>

                    <div style="background-color: #eff6ff; padding: 15px; border-radius: 8px; border: 2px solid var(--secondary-color); margin-top: 20px;">
                        <h6 style="color: var(--primary-color); margin-bottom: 10px;">Understanding Your Results:</h6>
                        <p style="line-height: 1.5; margin-bottom: 8px;">Higher scores indicate greater awareness and perceived use of reading strategies. Individual and subscale scores can help identify strengths and areas for improvement in your reading strategy use.</p>
                        <p style="line-height: 1.5;">These results can be used to design targeted instruction aimed at enhancing awareness and use of reading strategies, which are critical for reading comprehension success.</p>
                    </div>
                </div>

                <div class="export-section" role="group" aria-labelledby="export-heading">
                    <div class="sr-only" id="export-heading">Export Options</div>
                    <button class="export-btn" onclick="exportToPDF()" aria-describedby="pdf-help">
                        Export to PDF
                    </button>
                    <div id="pdf-help" class="sr-only">Download your results as a PDF document</div>
                    
                    <button class="export-btn" onclick="exportToExcel()" aria-describedby="excel-help">
                        Export to Excel
                    </button>
                    <div id="excel-help" class="sr-only">Download your results as an Excel spreadsheet</div>
                </div>
            </section>
        </main>
    </div>

    <script>
        // Strategy data
        const strategies = [
            { id: 1, text: "Having a purpose in mind when I read.", category: "global" },
            { id: 2, text: "Taking notes while reading.", category: "support" },
            { id: 3, text: "Previewing the text to see what it is about before reading it.", category: "global" },
            { id: 4, text: "Reading aloud to help me understand what I'm reading.", category: "support" },
            { id: 5, text: "Checking to see if the content of the text fits my purpose for reading.", category: "global" },
            { id: 6, text: "Discussing what I read with others to check my understanding.", category: "support" },
            { id: 7, text: "Getting back on track when getting sidetracked or distracted.", category: "problem" },
            { id: 8, text: "Underlining or circling important information in the text.", category: "support" },
            { id: 9, text: "Adjusting my reading pace or speed based on what I'm reading.", category: "problem" },
            { id: 10, text: "Using reference materials such as dictionaries to support my reading.", category: "support" },
            { id: 11, text: "Stopping from time to time to think about what I'm reading.", category: "problem" },
            { id: 12, text: "Using typographical aids like bold face and italics to pick out key information.", category: "global" },
            { id: 13, text: "Critically analyzing and evaluating the information read.", category: "global" },
            { id: 14, text: "Re-reading to make sure I understand what I'm reading.", category: "problem" },
            { id: 15, text: "Guessing the meaning of unknown words or phrases.", category: "problem" }
        ];

        // Store responses
        let responses = {};
        let isMouseUser = false;

        // Detect if user is using mouse vs keyboard
        document.addEventListener('mousedown', () => {
            isMouseUser = true;
            document.body.classList.add('mouse-user');
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Tab') {
                isMouseUser = false;
                document.body.classList.remove('mouse-user');
            }
        });

        // Generate strategy items with accessibility features
        function generateStrategies() {
            const container = document.getElementById('strategies-container');
            
            strategies.forEach(strategy => {
                const strategyDiv = document.createElement('div');
                strategyDiv.className = 'strategy-item';
                strategyDiv.setAttribute('role', 'group');
                strategyDiv.setAttribute('aria-labelledby', `strategy-${strategy.id}-text`);
                
                strategyDiv.innerHTML = `
                    <div class="strategy-header">
                        <div class="strategy-number" aria-hidden="true">${strategy.id.toString().padStart(2, '0')}</div>
                        <div class="strategy-text" id="strategy-${strategy.id}-text">${strategy.text}</div>
                    </div>
                    <fieldset class="rating-fieldset">
                        <legend class="rating-legend required">Rate your awareness and use of this strategy (1-5):</legend>
                        <div class="rating-options" role="radiogroup" aria-labelledby="strategy-${strategy.id}-text" aria-required="true">
                            ${[1, 2, 3, 4, 5].map(rating => `
                                <div class="rating-option">
                                    <input type="radio" 
                                           class="rating-input" 
                                           id="strategy-${strategy.id}-rating-${rating}" 
                                           name="strategy-${strategy.id}" 
                                           value="${rating}"
                                           onchange="selectRating(${strategy.id}, ${rating})"
                                           aria-describedby="rating-${rating}-description">
                                    <label for="strategy-${strategy.id}-rating-${rating}" class="rating-label">${rating}</label>
                                </div>
                            `).join('')}
                        </div>
                    </fieldset>
                `;
                container.appendChild(strategyDiv);
            });

            // Add hidden descriptions for rating values
            const descriptions = document.createElement('div');
            descriptions.className = 'sr-only';
            descriptions.innerHTML = `
                <div id="rating-1-description">1 means: I have never heard of this strategy before</div>
                <div id="rating-2-description">2 means: I have heard of this strategy, but I don't know what it means</div>
                <div id="rating-3-description">3 means: I have heard of this strategy, and I think I know what it means</div>
                <div id="rating-4-description">4 means: I know this strategy, and I can explain how and when to use it</div>
                <div id="rating-5-description">5 means: I know this strategy quite well, and I often use it when I read</div>
            `;
            container.appendChild(descriptions);
        }

        // Handle rating selection with accessibility announcements
        function selectRating(strategyId, rating) {
            responses[strategyId] = rating;
            
            // Update progress
            updateProgress();
            
            // Announce to screen readers
            const strategy = strategies.find(s => s.id === strategyId);
            const announcement = document.createElement('div');
            announcement.setAttribute('aria-live', 'polite');
            announcement.setAttribute('aria-atomic', 'true');
            announcement.className = 'sr-only';
            announcement.textContent = `Strategy ${strategyId} rated as ${rating}. ${strategy.text}`;
            document.body.appendChild(announcement);
            
            // Remove announcement after screen reader has time to read it
            setTimeout(() => {
                document.body.removeChild(announcement);
            }, 1000);
            
            // Calculate scores if all strategies are rated
            if (Object.keys(responses).length === 15) {
                calculateScores();
            }
        }

        // Update progress bar and text
        function updateProgress() {
            const completed = Object.keys(responses).length;
            const total = 15;
            const percentage = Math.round((completed / total) * 100);
            
            const progressFill = document.getElementById('progress-fill');
            const progressText = document.getElementById('progress-text');
            const progressBar = document.querySelector('.progress-bar');
            
            progressFill.style.width = `${percentage}%`;
            progressText.textContent = `${percentage}% Complete (${completed} of ${total} strategies rated)`;
            progressBar.setAttribute('aria-valuenow', percentage);
            
            if (completed === total) {
                const announcement = document.createElement('div');
                announcement.setAttribute('aria-live', 'assertive');
                announcement.setAttribute('aria-atomic', 'true');
                announcement.className = 'sr-only';
                announcement.textContent = 'All strategies have been rated. Your results are now available below.';
                document.body.appendChild(announcement);
                
                setTimeout(() => {
                    document.body.removeChild(announcement);
                }, 3000);
            }
        }

        // Calculate scores with accessibility announcements
        function calculateScores() {
            const globalItems = [1, 3, 5, 12, 13];
            const problemItems = [7, 9, 11, 14, 15];
            const supportItems = [2, 4, 6, 8, 10];

            const grsScore = globalItems.reduce((sum, item) => sum + (responses[item] || 0), 0) / 5;
            const pssScore = problemItems.reduce((sum, item) => sum + (responses[item] || 0), 0) / 5;
            const srsScore = supportItems.reduce((sum, item) => sum + (responses[item] || 0), 0) / 5;
            const totalScore = Object.values(responses).reduce((sum, val) => sum + val, 0) / 15;

            // Update display
            document.getElementById('grs-score').textContent = grsScore.toFixed(2);
            document.getElementById('pss-score').textContent = pssScore.toFixed(2);
            document.getElementById('srs-score').textContent = srsScore.toFixed(2);
            document.getElementById('total-score').textContent = totalScore.toFixed(2);

            // Update levels
            document.getElementById('grs-level').textContent = getLevel(grsScore);
            document.getElementById('pss-level').textContent = getLevel(pssScore);
            document.getElementById('srs-level').textContent = getLevel(srsScore);
            document.getElementById('total-level').textContent = getLevel(totalScore);

            // Update table scores
            document.getElementById('grs-table-score').textContent = grsScore.toFixed(2);
            document.getElementById('pss-table-score').textContent = pssScore.toFixed(2);
            document.getElementById('srs-table-score').textContent = srsScore.toFixed(2);
            document.getElementById('total-table-score').textContent = totalScore.toFixed(2);

            // Show results with focus management
            const resultsSection = document.getElementById('results-section');
            resultsSection.style.display = 'block';
            
            // Scroll to results and announce
            setTimeout(() => {
                resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                document.getElementById('results-heading').focus();
            }, 500);
        }

        // Get awareness level
        function getLevel(score) {
            if (score >= 3.5) return 'High level of awareness';
            if (score >= 2.5) return 'Medium level of awareness';
            return 'Low level of awareness';
        }

        // Validate form before processing
        function validateForm() {
            const errors = [];
            const requiredFields = [
                { id: 'name', label: 'Name' },
                { id: 'age', label: 'Age' },
                { id: 'grade', label: 'Grade' }
            ];

            const requiredRadioGroups = [
                { name: 'gender', label: 'Gender' },
                { name: 'ethnicity', label: 'Ethnicity' },
                { name: 'reading_level', label: 'Reading Level' }
            ];

            // Check text inputs
            requiredFields.forEach(field => {
                const element = document.getElementById(field.id);
                if (!element.value.trim()) {
                    errors.push(`${field.label} is required`);
                    element.classList.add('error-border');
                } else {
                    element.classList.remove('error-border');
                }
            });

            // Check radio groups
            requiredRadioGroups.forEach(group => {
                const checked = document.querySelector(`input[name="${group.name}"]:checked`);
                if (!checked) {
                    errors.push(`${group.label} selection is required`);
                }
            });

            // Check strategy ratings
            if (Object.keys(responses).length < 15) {
                errors.push(`Please rate all 15 strategies (${15 - Object.keys(responses).length} remaining)`);
            }

            return errors;
        }

        // Get form data with validation
        function getFormData() {
            const errors = validateForm();
            if (errors.length > 0) {
                alert('Please complete all required fields:\n\n' + errors.join('\n'));
                return null;
            }

            return {
                name: document.getElementById('name').value,
                age: document.getElementById('age').value,
                grade: document.getElementById('grade').value,
                gender: document.querySelector('input[name="gender"]:checked')?.value || '',
                ethnicity: document.querySelector('input[name="ethnicity"]:checked')?.value || '',
                reading_level: document.querySelector('input[name="reading_level"]:checked')?.value || '',
                responses: responses,
                scores: {
                    global: parseFloat(document.getElementById('grs-score').textContent),
                    problem: parseFloat(document.getElementById('pss-score').textContent),
                    support: parseFloat(document.getElementById('srs-score').textContent),
                    total: parseFloat(document.getElementById('total-score').textContent)
                },
                completionDate: new Date().toISOString()
            };
        }

        // Export to PDF with accessibility considerations
        function exportToPDF() {
            const data = getFormData();
            if (!data) return;

            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Header
                doc.setFontSize(20);
                doc.text('MARSI-R Results Report', 20, 20);
                
                doc.setFontSize(12);
                doc.text(`Date: ${new Date().toLocaleDateString()}`, 20, 30);
                doc.text(`Completion Time: ${new Date().toLocaleTimeString()}`, 20, 40);
                
                // Personal Information
                doc.setFontSize(16);
                doc.text('Personal Information', 20, 60);
                doc.setFontSize(12);
                doc.text(`Name: ${data.name}`, 20, 75);
                doc.text(`Age: ${data.age}`, 20, 85);
                doc.text(`Grade: ${data.grade}`, 20, 95);
                doc.text(`Gender: ${data.gender}`, 20, 105);
                doc.text(`Ethnicity: ${data.ethnicity}`, 20, 115);
                doc.text(`Reading Level: ${data.reading_level}`, 20, 125);
                
                // Scores
                doc.setFontSize(16);
                doc.text('Summary Scores', 20, 145);
                doc.setFontSize(12);
                doc.text(`Global Reading Strategies: ${data.scores.global.toFixed(2)} (${getLevel(data.scores.global)})`, 20, 160);
                doc.text(`Problem-Solving Strategies: ${data.scores.problem.toFixed(2)} (${getLevel(data.scores.problem)})`, 20, 170);
                doc.text(`Support Reading Strategies: ${data.scores.support.toFixed(2)} (${getLevel(data.scores.support)})`, 20, 180);
                doc.text(`Total Reading Strategies: ${data.scores.total.toFixed(2)} (${getLevel(data.scores.total)})`, 20, 190);
                
                // Interpretation
                doc.setFontSize(16);
                doc.text('Interpretation Guide', 20, 210);
                doc.setFontSize(10);
                doc.text('High level of awareness: 3.5 or higher', 20, 220);
                doc.text('Medium level of awareness: 2.5-3.4', 20, 230);
                doc.text('Low level of awareness: 2.4 or lower', 20, 240);
                
                // Individual responses on new page
                doc.addPage();
                doc.setFontSize(16);
                doc.text('Individual Strategy Responses', 20, 20);
                doc.setFontSize(10);
                
                let y = 35;
                strategies.forEach(strategy => {
                    if (y > 270) {
                        doc.addPage();
                        y = 20;
                    }
                    
                    const rating = data.responses[strategy.id] || 'Not answered';
                    const categoryLabel = strategy.category === 'global' ? 'Global' : 
                                         strategy.category === 'problem' ? 'Problem-Solving' : 'Support';
                    
                    doc.text(`${strategy.id}. ${strategy.text}`, 20, y);
                    doc.text(`   Rating: ${rating} | Category: ${categoryLabel}`, 20, y + 8);
                    y += 20;
                });
                
                const filename = `MARSI-R_Results_${data.name.replace(/[^a-zA-Z0-9]/g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`;
                doc.save(filename);
                
                // Announce success
                announceAction(`PDF exported successfully as ${filename}`);
                
            } catch (error) {
                console.error('PDF export error:', error);
                announceAction('Error exporting PDF. Please try again.');
            }
        }

        // Export to Excel with accessibility considerations
        function exportToExcel() {
            const data = getFormData();
            if (!data) return;

            try {
                const wb = XLSX.utils.book_new();
                
                // Summary sheet
                const summaryData = [
                    ['MARSI-R Results Summary'],
                    ['Generated:', new Date().toLocaleString()],
                    [''],
                    ['Personal Information'],
                    ['Name:', data.name],
                    ['Age:', data.age],
                    ['Grade:', data.grade],
                    ['Gender:', data.gender],
                    ['Ethnicity:', data.ethnicity],
                    ['Reading Level:', data.reading_level],
                    [''],
                    ['Summary Scores'],
                    ['Category', 'Score', 'Level'],
                    ['Global Reading Strategies', data.scores.global.toFixed(2), getLevel(data.scores.global)],
                    ['Problem-Solving Strategies', data.scores.problem.toFixed(2), getLevel(data.scores.problem)],
                    ['Support Reading Strategies', data.scores.support.toFixed(2), getLevel(data.scores.support)],
                    ['Total Reading Strategies', data.scores.total.toFixed(2), getLevel(data.scores.total)],
                    [''],
                    ['Interpretation Guide'],
                    ['High level of awareness: 3.5 or higher'],
                    ['Medium level of awareness: 2.5-3.4'],
                    ['Low level of awareness: 2.4 or lower']
                ];
                
                const summaryWs = XLSX.utils.aoa_to_sheet(summaryData);
                XLSX.utils.book_append_sheet(wb, summaryWs, 'Summary');
                
                // Detailed responses sheet
                const detailedData = [
                    ['Strategy Number', 'Strategy Text', 'Category', 'Response', 'Response Meaning']
                ];
                
                const responseDescriptions = {
                    1: 'I have never heard of this strategy before',
                    2: 'I have heard of this strategy, but I don\'t know what it means',
                    3: 'I have heard of this strategy, and I think I know what it means',
                    4: 'I know this strategy, and I can explain how and when to use it',
                    5: 'I know this strategy quite well, and I often use it when I read'
                };
                
                strategies.forEach(strategy => {
                    const rating = data.responses[strategy.id] || 'Not answered';
                    const categoryLabel = strategy.category === 'global' ? 'Global Reading Strategies' : 
                                         strategy.category === 'problem' ? 'Problem-Solving Strategies' : 'Support Reading Strategies';
                    const meaning = rating !== 'Not answered' ? responseDescriptions[rating] : '';
                    
                    detailedData.push([
                        strategy.id,
                        strategy.text,
                        categoryLabel,
                        rating,
                        meaning
                    ]);
                });
                
                const detailedWs = XLSX.utils.aoa_to_sheet(detailedData);
                XLSX.utils.book_append_sheet(wb, detailedWs, 'Detailed Responses');
                
                // Category breakdown sheet
                const categoryData = [
                    ['Category Breakdown'],
                    [''],
                    ['Global Reading Strategies'],
                    ['Strategy', 'Text', 'Rating']
                ];
                
                [1, 3, 5, 12, 13].forEach(id => {
                    const strategy = strategies.find(s => s.id === id);
                    categoryData.push([id, strategy.text, data.responses[id] || 'Not answered']);
                });
                
                categoryData.push(['', '', '']);
                categoryData.push(['Problem-Solving Strategies']);
                categoryData.push(['Strategy', 'Text', 'Rating']);
                
                [7, 9, 11, 14, 15].forEach(id => {
                    const strategy = strategies.find(s => s.id === id);
                    categoryData.push([id, strategy.text, data.responses[id] || 'Not answered']);
                });
                
                categoryData.push(['', '', '']);
                categoryData.push(['Support Reading Strategies']);
                categoryData.push(['Strategy', 'Text', 'Rating']);
                
                [2, 4, 6, 8, 10].forEach(id => {
                    const strategy = strategies.find(s => s.id === id);
                    categoryData.push([id, strategy.text, data.responses[id] || 'Not answered']);
                });
                
                const categoryWs = XLSX.utils.aoa_to_sheet(categoryData);
                XLSX.utils.book_append_sheet(wb, categoryWs, 'Category Breakdown');
                
                const filename = `MARSI-R_Results_${data.name.replace(/[^a-zA-Z0-9]/g, '_')}_${new Date().toISOString().split('T')[0]}.xlsx`;
                XLSX.writeFile(wb, filename);
                
                // Announce success
                announceAction(`Excel file exported successfully as ${filename}`);
                
            } catch (error) {
                console.error('Excel export error:', error);
                announceAction('Error exporting Excel file. Please try again.');
            }
        }

        // Announce actions to screen readers
        function announceAction(message) {
            const announcement = document.createElement('div');
            announcement.setAttribute('aria-live', 'assertive');
            announcement.setAttribute('aria-atomic', 'true');
            announcement.className = 'sr-only';
            announcement.textContent = message;
            document.body.appendChild(announcement);
            
            setTimeout(() => {
                if (document.body.contains(announcement)) {
                    document.body.removeChild(announcement);
                }
            }, 3000);
        }

        // Keyboard navigation enhancements
        document.addEventListener('keydown', function(e) {
            // Allow Enter key to activate buttons
            if (e.key === 'Enter' && e.target.classList.contains('export-btn')) {
                e.target.click();
            }
            
            // Provide keyboard shortcuts for common actions
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 's':
                        e.preventDefault();
                        if (Object.keys(responses).length === 15) {
                            exportToPDF();
                        } else {
                            announceAction('Please complete all strategies before saving.');
                        }
                        break;
                    case 'e':
                        e.preventDefault();
                        if (Object.keys(responses).length === 15) {
                            exportToExcel();
                        } else {
                            announceAction('Please complete all strategies before exporting.');
                        }
                        break;
                }
            }
        });

        // Form validation on input
        document.addEventListener('input', function(e) {
            if (e.target.hasAttribute('required') && e.target.value.trim()) {
                e.target.classList.remove('error-border');
            }
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            generateStrategies();
            
            // Announce page ready to screen readers
            setTimeout(() => {
                announceAction('MARSI-R Digital Inventory loaded and ready for completion. Please fill out the general information section first, then rate each of the 15 reading strategies.');
            }, 1000);
            
            // Focus management - focus on first input
            document.getElementById('name').focus();
        });

        // Add keyboard shortcut help
        document.addEventListener('keydown', function(e) {
            if (e.key === 'F1' || (e.altKey && e.key === 'h')) {
                e.preventDefault();
                const helpText = `
                Keyboard shortcuts:
                - Tab: Navigate between elements
                - Arrow keys: Navigate radio button groups
                - Space: Select radio buttons and checkboxes
                - Enter: Activate buttons
                - Ctrl+S (Cmd+S): Save as PDF
                - Ctrl+E (Cmd+E): Export to Excel
                - F1 or Alt+H: This help message
                `;
                announceAction(helpText);
            }
        });
    </script>
</body>
</html>
